<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<title>Sourcerer Project: Tutorial</title>
<link rel="stylesheet" href="css/sourcerer.css" type="text/css" />
</head>

<body>
<div id="container">
<div id="header">
<div id="a1"></div>
<div id="a2"></div>
<div id="a3"></div>
<div id="a4"></div>
<div id="a5"></div>
The Sourcerer Project
</div>
<div id="content">
<div id="main">
<h1>Tutorial</h1>
<p>
  This tutorial is designed to show the reader how to download, install,
  and use the Sourcerer infrastructure to build SourcererDB. Before you begin,
  you should make sure to have a working version of the Java Development Kit, 
  <a href="http://git-scm.com/">Git</a>, <a href="http://ant.apache.org/">Ant</a>,
  and <a href="http://www.eclipse.org">Eclipse</a> installed.
</p>
<p>
  This tutorial is written to use the command line wherever possible. All of the
  ant tasks can be done through Eclipse, and will be indicated as such during
  the tutorial.
</p>

<h2>Step 1: <span class="colora">Download Sourcerer</span></h2>
<div class="sub">
  <p>
    Run
  </p>
  <div class="code-block">
    [install]$ git clone https://github.com/sourcerer/Sourcerer.git
  </div>
  <p>
    where <span class="code">[install]</span> is the directory into which
    you wish to download Sourcerer.
  </p>
  
  <h3>Optional) Load Sourcerer in Eclipse</h3>
  <div class="sub">
    <p>
      If you wish to complete this tutorial using Eclipse, do
      the following once you have opened a fresh Eclipse workspace.
    </p>
    <ol>
      <li>Go to <span class="fixed">File-&gt;Import</span></li>
      <li>Select <span class="fixed">General-&gt;Existing Projects into Workspace</span> and hit <span class="fixed">Next</span>.</li>
      <li>Click <span class="fixed">Browse</span> next to <span class="fixed">Select Root Directory</span>.</li>
      <li>Navigate to the <span class="fixed">[install]/Sourcerer</span> directory and click <span class="fixed">OK</span>.</li>
      <li>Make sure the following projects are selected
        <ul>
          <li><span class="fixed">bin</span></li>
          <li><span class="fixed">database</span></li>
          <li><span class="fixed">extractor</span></li>
          <li><span class="fixed">lib</span></li>
          <li><span class="fixed">model</span></li>
          <li><span class="fixed">repository-manager</span></li>
          <li><span class="fixed">utilities</span></li>
        </ul>
      </li>
      <li>Click finish, and wait for the projects to build.</li>
      <li>
        Once built, there should still be errors in the <span class="fixed">extractor</span> project.
        To correct these, go to the <span class="fixed">bin</span> project, and run <span class="fixed">launch-&gt;lib-&gt;sourcerer-lib.launch</span>.
        Then refresh the <span class="fixed">bin</span> project, and the errors should disappear.
      </li> 
    </ol>
  </div>
</div>

<h2>Step 2: <span class="colora">Set up a Repository</span></h2>
<div class="sub">
  <p>
    For the purposes of the tutorial, there are four ways of doing this. They
    all result in a repository located in a directory referred to as <span class="code">[root]</span>
    for the remainder of this tutorial. So pick either 2.A, 2.B, 2.C or 2.D.
  </p>

  <h3>2.A) Create the test-repository</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch-&gt;test-repo-&gt;Create test repo.launch</span>)
    </p>
    <div class="code-block">
      [install]$ cd Sourcerer/bin<br>
      [install]/Sourcerer/bin$ ant create-test-repo
    </div>
    <p>
      This creates a test repository. To view it's contents, run
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ cd ../infrastructure/tools/java/extractor/test-repo<br>
      [install]/Sourcerer/infrastructure/tools/java/extractor/test-repo$ ls
    </div>
    <p>
      This test repository contains two projects, 0/0, a project for testing the 
      feature extractor, and 0/1, the Sourcerer project itself.
    </p>
  </div>

  <h3>2.B) Download a sample repository</h3>
  <div class="sub">
    <p>
      A sample repository containing a small random selection of projects from 
      the full repository can be found online
      <a href="http://sourcerer.ics.uci.edu/files/sample-repo.tgz">here</a>.
      Simply download this file and extract it to the desired directory.
    </p>
  </div>
  
  <h3>2.C) Download the full repository</h3>
  <div class="sub">
    <p>
      The full repository can be found online 
      <a href="http://www.ics.uci.edu/~lopes/datasets/SDS_source-repo-18k.html">here</a>.
      Simply download this file (very very big) and extract it to the desired directory.
    </p>
  </div>
  
  <h3>2.D) Create your own repository</h3>
  <div class="sub">
    <p>
      To create a repository with custom, simply follow the repository 
      structure <a href="repository.html">here</a>.
    </p>
    
    <h4>2.D.1) Create <span class="fixed">[ROOT]</span> directory</h4>
    <div class="sub">
      <div class="code-block">
        [?]$ mkdir [root]<br>
        [?]$ cd [root]
      </div>
    </div>
    
    <h4>2.D.2) Create project directories</h4>
    <div class="sub">
      <p>
        For every project you wish to include in the repository, create a subdirectory of
        <span class="fixed">[root]</span> of the form <span class="fixed">[root]/[number]/[number]</span>.
        For example, if you wanted to create a repository with 3 projects, you would do the following.
      </p>
      <div class="code-block">
        [root]$ mkdir 0<br>
        [root]$ mkdir 0/0<br>
        [root]$ mkdir 0/1<br>
        [root]$ mkdir 0/2<br>
        [root]$ ls<br>
        0<br>
        [root]/0$ cd 0<br>
        [root]$ ls<br>
        0 1 2
      </div>
      <p>
        This creates space for 3 projects. It doesn't matter what numbers are picked 
        for the directories, as long as they are numbers.
      </p>
    </div>
    
    <h4>2.D.3) Add project content</h4>
    <div class="sub">
      <p>
        To add the actual content for each project, do the following.
      </p>
      <div class="code-block">
        [root]/0$ cd 0<br>
        [root]/0/0$ mkdir content<br>
        [root]/0/0$ cp -R [project-content]/* content
      </div>
      <p>
        This copies the contents of the project from some <span class="code">[project-content]</span>
        directory into the content directory of the repository. This content can be any combination of Java 
        source code and jar files.
      </p>
    </div>
  
    <h4>2.D.4) Create <span class="fixed">project.properties</span> files</h4>
    <div class="sub">
      <div class="code-block">
        [root]/0/0$ echo name=[project-name] &gt; project.properties
      </div>
      <p>
        There are a number of other supported properties, but the only required one is name.
      </p>
    </div>
  </div>
</div>

<h2>Step 3: <span class="colora">Compile the repository tools</span></h2>
<div class="sub">
  <h3>3.A) Compile</h3>
  <div class="sub">
    <p>
      <span class="colora bold">Note</span>: This step need only be completed if you wish to use the repository tools from the command line.
    </p>
    <p>
      Run (Eclipse launcher <span class="fixed">launch-&gt;lib-&gt;repo-tools.launch</span>)
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ ant repo-tools 
    </div>
    <p>
      This will create <span class="fixed">repo-tools.jar</span> in the <span class="fixed">dist</span> subdirectory. We will
      refer to this subdirectory as <span class="fixed">[install-dist]</span>.
    </p>
  </div>
  <h3>3.B) Test</h3>
  <div class="sub">
    <p>
      Running (Eclipse launcher <span class="fixed">launch-&gt;tutorial-&gt;Step 3 - Repo Tools.launch</span>)
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ cd dist<br>
      [install-dist]$ java -jar repo-tools.jar
    </div>
    <p>
      will print a complete list of the commands provided by <span class="fixed">repo-tools.jar</span>.
    </p>
  </div>
</div>

<h2>Step 4: <span class="colora">Finish setting up the repository</span></h2>
<div class="sub">
  <p>
    <span class="colora bold">Note</span>: If you used step 2.A (create-test-repo ant task), these tasks have already been run and you may skip this step.
  </p>
  
  <h3>4.1) Aggregate jar files</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch-&gt;tutorial-&gt;Step 4 - Aggregate Jar Files.launch</span>)
    </p>
    <div class="code-block">
      [install-dist]$ java -jar repo-tools.jar --aggregate-jar-files --input-repo [root]
    </div>
    <p>
      If you are using Eclipse, a dialog will pop up asking for the value of <span class="fixed">input-repo</span>.
      You should direct it to the root of the repository you created in Step 2.
    </p>
    <p>
      If you are running it from the command line, you should replace <span class="fixed">[root]</span> with the
      path to the repository you created in Step 2.
    </p>
    <p>
      This collects all of the jar files in the repository into the jars directory. To see the result, do the following.
    </p>
    <div class="code-block">
      [?]$ cd [root]<br>
      [root]$ ls jars<br>
      jars<br>
      [root]$ cd jars<br>
      [root]/jars$ ls<br>
      project
    </div>
    <p>
      The project subdirectory contains all of the jar files aggregated from the repository. They are stored in a two-layered structure
      of directories, similar to the main repository itself.
    </p>
  </div>
  
  <h3>4.2) Create jar index</h3>
  <div class="sub">
    <p>
      Next, run the following command to create the jar index. (Eclipse launcher <span class="fixed">launch-&gt;tutorial-&gt;Step 4 - Create Jar Index.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist<br>
      [install-dist]$ java -jar repo-tools.jar --create-jar-index --input-repo [root]
    </div>
    <p>
      This creates the jar index file in the jars directory, which is a list of all the jar files in the repository. To view it, do the following.
    </p>
    <div class="code-block">
      [?]$ cd [root]/jars<br>
      [root]/jars$ less index.txt<br>
    </div>
  </div>
  
  <h3>4.3) Clean jar manifests</h3>
  <div class="sub">
    <p>
      Finally, run the following command to clean out the jar manifests. (Eclipse launcher <span class="fixed">launch-&gt;tutorial-&gt;Step 4 - Clean Jar Manifests.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist<br>
      [install-dist]$ java -jar repo-tools.jar --clean-jar-manifests --input-repo [root]
    </div>
    <p>
      The effect of this command is to remove all classpath manifest entries from jar files contained in the jars directory.
    </p>
  </div>
  
  <h3>4.4) Other commands</h3>
  <div class="sub">
    <p>
      Some other commands that might be interesting to run are: (the Eclipse launchers are all found in <span class="fixed">launch-&gt;tutorial</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist<br>
      [install-dist]$ java -jar repo-tools.jar --print-repo-disk-usage --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-project-names --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-jar-stats --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-project-sizes --input-repo [root]<br>
    </div>
    <p>
      If you wish for the output logs to be saved to a file, the <span class="fixed">--output [path]</span>
      parameter may be added. When this parameter is specified, logs are saved to 
      <span class="fixed">[path]/[command name]/[date]/[time]</span> and are no longer printed to the command line. 
      To have them printed to the command line again, add the <span class="fixed">--report-to-console</span> flag.
    </p>
  </div>
</div>

<h2>Step 5: <span class="colora">Set up the Extractor</span></h2>
<div class="sub">
  <p>
    <span class="colora bold">Note</span>: The following steps only need to be done if you wish to run the Extractor from the command line.
    They are not necessary if you are doing this tutorial through Eclipse.
  </p>
  <h3>5.A) Build Extractor plugin</h3>
  <div class="sub">
    <p>
      Unfortunately, as the extractor is an Eclipse plugin, this step cannot be done from the command line.
      You can download the plugin <a href="">here</a>. Place it in the <span class="fixed">[install]/Sourcerer/bin/plugins</span>
      directory (you will have to create this directory).
    </p>
    <p>
      If you decided to load the projects into Eclipse, you can instead run <span class="fixed">launch-&gt;extractor-&gt;Build Extractor</span>.
      This Eclipse-specific ant task will create the plugin and place it in the directory mentioned above.
    </p>
    <p>
      Next, run <span class="fixed">launch-&gt;extractor-&gt;Repackage Extractor.launch</span>
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin<br>
      [install]/Sourcerer/bin$ ant repackage-extractor<br>
    </div>
    <p>
      This ant task will repackage the plugin to contain the necessary dependencies, and will place it in the <span class="fixed">dist</span> directory.
    </p>
  </div>
  <h3>5.B) Copy plugin into Eclipse</h3>
  <div class="sub">
    <p>
      As the Extractor is a headless Eclipse plugin, it must be installed into a working Eclipse instance. This installation can be done as follows:
    <p>
    <ol>
      <li>Download a recent version of Eclipse and extract it to some directory <span class="fixed">[eclipse]</span>.</li>
      <li>Place the Extractor_1.0.0.jar file generated by the ant task in the [eclipse]/plugins directory.</li>
    </ol>
    <p>
      To test that it's working, try to run
  </div>
</div>
<pre style="
white-space: -moz-pre-wrap;
white-space: -pre-wrap;
white-space: -o-pre-wrap;
white-space: pre-wrap;
word-wrap: break-word;
">

To test that it's working, try to run
java -jar [eclipse]/plugins/org.eclipse.[version-name].launcher_[version-number].jar -consolelog -application Extractor.Extractor

The result should be a list of the commands the extractor supports.

Step 6: Run the Extractor
The first step in extraction is to extract from the Java library code. To do so, run

java -jar [...] -application Extractor.Extractor --extract-libraries --output-repo [path] --output [path] &

It is recommended to run this in the background (using &), as it can take a while to complete. Also, due to Eclipse's headless functionality, output that is not directed using the --output parameter is blocked until completion of the application, so no updates are received.

You can track the progress of the extractor by running tail -f [output-path]/extract-libraries/[date]/[time]/error.log or info.log. 

The results of the extraction can be seen in [output-repo-path]/libs/. The extracted data for each Java library jar file is contained within the directory with that jar file's name. rt.jar contains the vast majority of the Java library. Looking into any directory, you can see the various flat files that are used to build the database.

Next, extract the jar files using
java -jar [...] -application Extractor.Extractor --extract-jars --input-repo [path] --output-repo [path] --output [path] &

Notice that an input-repo is needed this time, as the jar files are not being picked off the Java classpath.

The results of this extraction can be found in [output-repo-path]/jars/.

Lastly, extract the source files using
java -jar [...] -application Extractor.Extractor --extract-projects --input-repo [path] --output-repo [path] --output [path] &

The results of this extraction can be found in [output-repo-path].

To view some summary statistics of the extraction, please run
java -jar [path to repo-tools.jar] --extraction-stats --input-repo [path-to-output-repo]

This will create an extraction-stats.txt file which contains some details on what was extracted from the repository.

Step 7: Set up database
To complete the remainder of this tutorial, you must have access to a MySQL database to which the extracted information can be imported.

Once a mysql database is set up, the user simply needs to create a database by typing
create database [name];

And make sure to give the user you wish to use proper permissions
grant all on [name].* to [user];

Sourcerer database tools will handle the remainder.

Step 8: Set up the database tools
To compile the basic repository tools, navigate to the [install]/Sourcerer/bin directory and run
ant sourcerer-db

This will create a sourcerer-db.jar in [install]/Sourcerer/bin/dist

Step 9: Import to database

Start by initializing the tables.

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --initialize-db

Then import the libraries

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-libraries --input-repo [path-to-output-repo] --output &

Then import the jars

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-jars --input-repo [path-to-output-repo] --output &

Then import the projects

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-projects --input-repo [path-to-output-repo] --output &

It's best to run these as background processes, as they can take quite a while.

Step 10: Explore the database
Connect to the database and look around at what you have.

Further steps:
There are a variety of things that can be done once you have a repository up and running, but are beyond the scope of this tutorial. This includes how to set up a Lucene search index and a running version of the Sourcerer search engine, as well as tools for evaluating the amount of clones present in the repository. I hope this tutorial gives a bit of a sense of how Sourcerer works, and I would be happy to answer any further questions, or work out any issues there might be with these steps.
</pre>
</div>
</div>
<div id="navbar">
  <div><a href="index.html">Overview</a></div>
  <div><a href="infrastructure.html">Core Infrastructure</a></div>
  <div><a href="repository.html">Repository</a></div>
  <div><a href="sourcerer-db.html">SourcererDB</a></div>
  <div><a href="services.html">Services</a></div>
  <div><a href="code-search-engine.html">Code Search Engine</a></div>
  <!--<div><a href="code-genie.html">CodeGenie</a></div> -->
  <div><a class="sel" href="tutorial.html">Tutorial</a></div>
  <div><a href="people.html">People</a></div>
  <div><a href="publications.html">Publications</a></div>
</div>
</div>
</body>
</html>
