<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<title>Sourcerer Project: Tutorial</title>
<link rel="stylesheet" href="css/sourcerer.css" type="text/css" />
</head>

<body>
<div id="container">
<div id="header">
<div id="a1"></div>
<div id="a2"></div>
<div id="a3"></div>
<div id="a4"></div>
<div id="a5"></div>
The Sourcerer Project
</div>
<div id="content">
<div id="main">
<h1>Tutorial</h1>
<p>This tutorial is designed to show the reader how to download, install,
and use the Sourcerer infrastructure to build SourcererDB. Before you begin,
you should make sure to have a working version of the Java Development Kit, 
<a href="http://git-scm.com/">Git</a> and <a href="http://ant.apache.org/">Ant</a> installed.
</p>
<h2>Step 1: <span class="colora">Download Sourcerer</span></h2>
<p>Run</p>
<div class="code-block">
[install]$ git clone https://github.com/sourcerer/Sourcerer.git
</div>
<p>
where <span class="code">[install]</span> is the directory into which
you wish to download Sourcerer.
</p>
<h2>Step 2: <span class="colora">Set up a Repository</span></h2>
<p>For the purposes of the tutorial, there are four ways of doing this. They
all result in a repository located in a directory referred to as <span class="code">[root]</span>
for the remainder of this tutorial.</p>
<h3>A) Create the test-repository</h3>
<p>Run</p>
<div class="code-block">
[install]$ cd Sourcerer/bin<br>
[install]/Sourcerer/bin$ ant create-test-repo
</div>
<p>
This creates a test repository. To view it's contents, run
</p>
<div class="code-block">
[install]/Sourcerer/bin$ cd ../infrastructure/tools/java/extractor/test-repo<br>
[install]/Sourcerer/infrastructure/tools/java/extractor/test-repo$ ls
</div>
<p>This test repository contains two projects, 0/0, a project for testing the 
feature extractor, and 0/1, the Sourcerer project itself.
</p>
<h3>B) Download a sample repository</h3>
<p>
A sample repository containing a small random selection of projects from 
the full repository can be found online
<a href="http://sourcerer.ics.uci.edu/files/sample-repo.tgz">here</a>.
Simply download this file and extract it to the desired directory.
</p>
<h3>C) Download the full repository</h3>
<p>The full repository can be found online 
<a href="http://www.ics.uci.edu/~lopes/datasets/SDS_source-repo-18k.html">here</a>.
Simply download this file (very very big) and extract it to the desired directory.
</p>
<h3>D) Create your own repository</h3>
<p>To create a repository with custom, simply follow the repository 
structure <a href="repository.html">here</a>. 
<h4>2D.1 Designate a directory as the root of the repository, henceforth referred to as <span class="code">[ROOT]</span>.</h4>
<div class="code-block">
[?]$ mkdir [root]<br>
[?]$ cd [root]
</div>
<p>Next, for every project you wish to include in the repository, create a subdirectory of
<span class="code">[root]</span> of the form <span class="code">[root]/[number]/[number]</span>.</p>
<div class="code-block">
[root]$ mkdir 0<br>
[root]$ mkdir 0/0<br>
[root]$ mkdir 0/1<br>
[root]$ mkdir 0/2<br>
[root]$ ls<br>
0<br>
[root]/0$ cd 0<br>
[root]$ ls<br>
0 1 2
</div>
<p>This creates space for 3 projects. It doesn't matter what numbers are picked 
for the directories, as long as they are numbers.</p>
<p>To add the actual content for each project, do the following.</p>
<div class="code-block">
[root]/0$ cd 0<br>
[root]/0/0$ mkdir content<br>
[root]/0/0$ cp -R [project-content]/* content
</div>
<p>This copies the contents of the project from some <span class="code">[project-content]</span>
directory into the content directory of the repository. This content can be any combination of Java 
source code and jar files.</p>
<p>The final step is to create the project properties file.</p>
<div class="code-block">
[root]/0/0$ echo name=[project-name] &gt; project.properties
</div>
<p>There are a number of other supported properties, but the only required one is name.</p>
<p>Simply do this (by hand or automatically) for every project you wish to include, and you
will have a custom repository.</p>
<h2>Step 3: <span class="colora">Compile the repository tools</span></h2>
<p>Run</p>
<div class="code-block">
[install]/Sourcerer/bin$ ant repo-tools 
</div>
<p>This will create <span class="code">repo-tools.jar</span> in the <span class="code">dist</span> subdirectory.
Running</p>
<div class="code-block">
[install]/Sourcerer/bin$ cd dist<br>
[install]/Sourcerer/bin/dist$ java -jar repo-tools.jar
</div>
<p>will print a complete list of the commands provided by <span class="code">repo-tools.jar</span>.
<h2>Step 4: <span class="colora">Finish setting up the repository</span></h2>
<p><span class="colora bold">Note</span>: If you used step 2A (create-test-repo ant task), these tasks have already been run and you may skip this step.</p>
<p>Run</p>
<div class="code-block">
[install]/Sourcerer/bin/dist$ java -jar repo-tools.jar --aggregate-jar-files --input-repo [root]
</div>
<p>This collects all of the jar files in the repository into the jars directory. To see the result, do the following.</p>
<div class="code-block">
[?]$ cd [root]<br>
[root]$ ls jars<br>
jars<br>
[root]$ cd jars<br>
[root]/jars$ ls<br>
project
</div>
<p>The project subdirectory contains all of the jar files aggregated from the repository. They are stored in a two-layered structure
of directories, similar to the main repository itself.</p>
<p>Next, run the following command to create the jar index.</p>
<div class="code-block">
[?]$ cd [install]/Sourcerer/bin/dist<br>
[install]/Sourcerer/bin/dist$
java -jar repo-tools.jar --create-jar-index --input-repo [root]
</div>
<p>This creates the jar index file in the jars directory, which is a list of all the jar files in the repository. To view it, do the following.</p>
<div class="code-block">
[?]$ cd [root]/jars<br>
[root]/jars$ less index.txt<br>
</div>
<p>Finally, run the following command to clean out the jar manifests.</p>
<div class="code-block">
[?]$ cd [install]/Sourcerer/bin/dist<br>
[install]/Sourcerer/bin/dist$ java -jar repo-tools.jar --clean-jar-manifests --input-repo [root]
</div>
<p>The effect of this command is to remove all classpath manifest entries from jar files contained in the jars directory.</p>

<pre style="
white-space: -moz-pre-wrap;
white-space: -pre-wrap;
white-space: -o-pre-wrap;
white-space: pre-wrap;
word-wrap: break-word;
">
Some other commands that might be interesting to run are:
print-repo-disk-usage
print-project-names
print-jar-stats
print-project-sizes

To see the list of required inputs for any command, run
java -jar [path to repo-tools.jar] --[command]

Each of the above commands only requires the input-repo parameter.

If you wish for the output logs to be saved to a file, the --output [path] parameter may be added. When this parameter is specified, logs are saved to [path]/[command name]/[date]/[time] and are no longer printed to the command line. To have them printed to the command line again, add the --report-to-console flag.

Step 5: Set up the Extractor
Unfortunately, as the extractor is an Eclipse plugin, this step cannot be done from the command line. The Eclipse-specific ant task extractor must be run, which requires the following Eclipse projects to be loaded: bin, extractor, model, repository-manager, and utilities.

Next, run the ant task
ant repackage-extractor

This task creates the final version of the extractor plugin, which can be found at [install]/Sourcerer/bin/dist/Extractor_1.0.0.jar

As the Extractor is a headless Eclipse plugin, it must be installed into a working Eclipse instance. This installation can be done as follows:
* Download a recent version of Eclipse and extract it to some directory [eclipse].
* Place the Extractor_1.0.0.jar file generated by the ant task in the [eclipse]/plugins directory

To test that it's working, try to run
java -jar [eclipse]/plugins/org.eclipse.[version-name].launcher_[version-number].jar -consolelog -application Extractor.Extractor

The result should be a list of the commands the extractor supports.

Step 6: Run the Extractor
The first step in extraction is to extract from the Java library code. To do so, run

java -jar [...] -application Extractor.Extractor --extract-libraries --output-repo [path] --output [path] &

It is recommended to run this in the background (using &), as it can take a while to complete. Also, due to Eclipse's headless functionality, output that is not directed using the --output parameter is blocked until completion of the application, so no updates are received.

You can track the progress of the extractor by running tail -f [output-path]/extract-libraries/[date]/[time]/error.log or info.log. 

The results of the extraction can be seen in [output-repo-path]/libs/. The extracted data for each Java library jar file is contained within the directory with that jar file's name. rt.jar contains the vast majority of the Java library. Looking into any directory, you can see the various flat files that are used to build the database.

Next, extract the jar files using
java -jar [...] -application Extractor.Extractor --extract-jars --input-repo [path] --output-repo [path] --output [path] &

Notice that an input-repo is needed this time, as the jar files are not being picked off the Java classpath.

The results of this extraction can be found in [output-repo-path]/jars/.

Lastly, extract the source files using
java -jar [...] -application Extractor.Extractor --extract-projects --input-repo [path] --output-repo [path] --output [path] &

The results of this extraction can be found in [output-repo-path].

To view some summary statistics of the extraction, please run
java -jar [path to repo-tools.jar] --extraction-stats --input-repo [path-to-output-repo]

This will create an extraction-stats.txt file which contains some details on what was extracted from the repository.

Step 7: Set up database
To complete the remainder of this tutorial, you must have access to a MySQL database to which the extracted information can be imported.

Once a mysql database is set up, the user simply needs to create a database by typing
create database [name];

And make sure to give the user you wish to use proper permissions
grant all on [name].* to [user];

Sourcerer database tools will handle the remainder.

Step 8: Set up the database tools
To compile the basic repository tools, navigate to the [install]/Sourcerer/bin directory and run
ant sourcerer-db

This will create a sourcerer-db.jar in [install]/Sourcerer/bin/dist

Step 9: Import to database

Start by initializing the tables.

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --initialize-db

Then import the libraries

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-libraries --input-repo [path-to-output-repo] --output &

Then import the jars

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-jars --input-repo [path-to-output-repo] --output &

Then import the projects

java -jar [path to sourcerer-db.jar] --database-url jdbc:mysql://[url of database]/[name of database] --database-user [user] --database-password [password] --add-projects --input-repo [path-to-output-repo] --output &

It's best to run these as background processes, as they can take quite a while.

Step 10: Explore the database
Connect to the database and look around at what you have.

Further steps:
There are a variety of things that can be done once you have a repository up and running, but are beyond the scope of this tutorial. This includes how to set up a Lucene search index and a running version of the Sourcerer search engine, as well as tools for evaluating the amount of clones present in the repository. I hope this tutorial gives a bit of a sense of how Sourcerer works, and I would be happy to answer any further questions, or work out any issues there might be with these steps.
</pre>
</div>
</div>
<div id="navbar">
  <div><a href="index.html">Overview</a></div>
  <div><a href="infrastructure.html">Core Infrastructure</a></div>
  <div><a href="repository.html">Repository</a></div>
  <div><a href="sourcerer-db.html">SourcererDB</a></div>
  <div><a href="services.html">Services</a></div>
  <div><a href="code-search-engine.html">Code Search Engine</a></div>
  <!--<div><a href="code-genie.html">CodeGenie</a></div> -->
  <div><a class="sel" href="tutorial.html">Tutorial</a></div>
  <div><a href="people.html">People</a></div>
  <div><a href="publications.html">Publications</a></div>
</div>
</div>
</body>
</html>
